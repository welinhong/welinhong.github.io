---
title: Refactoring - Ch8. 기능 이동
date: "2021-08-08"
description: Martin Fowler의 Refactoring 'Ch.8 기능이동'을 읽고 정리한 내용입니다.
---

### 8.1 함수 옮기기

- 모듈성
    - 좋은 소프트웨어 설계의 핵심은 모듈화가 얼마나 잘 되어 있느냐를 뜻하는 **모듈성(modularity)** 이다.
    - 모듈성은 프로그램의 어딘가를 수정하려 할 때 해당 기능과 깊이 관련된 작은 일부만 이해해도 가능하게 해주는 능력이다.
    - 모듈성을 높이려면 서로 연관된 요소들을 함께 묶어서 요소 사이의 연결 관계를 쉽게 찾고 이해할 수 있도록 해야 한다. → 즉, 함수 옮기기를 통해서 함수를 다른 클래스나 모듈로 옮긴다
- `팁` 중첩 함수를 사용하다보면 숨겨진 데이터끼리 상호 의존하기가 아주 쉬우니 중첩 함수는 되도록 만들지 말자
- `용어` 린터(linter): 정적 분석기. 소스 코드를 분석하여 프로그램의 오류, 버그, 스타일 오류, 의심스러운 구조체에 표시를 달아놓기 위한 도구 (wikipedia)

### 8.2 필드 옮기기

**프로그램의 진짜 힘은 데이터 구조에서 나온다.** 주어진 문제에 적합한 데이터 구조를 활용하면 동작 코드는 자연스럽게 단순하고 직관적으로 짜여진다. → 데이터가 복잡하거나 사용하는 곳에 맞지 않는 구조라면, 데이터를 주어진 문제에 적합하게 구조를 변경하여 사용한다.

- 데이터 구조가 적절치 않음을 깨닫게 되면 곧바로 수정해야 한다.
- 함수에 항상 함께 건네지는 데이터 조각들은 상호 관계가 명확하게 드러나도록 한 레코드에 담는 게 가장 좋다

### 8.3 문장을 함수로 옮기기

- 특정 함수를 호출하는 코드가 나올 때마다 그 앞이나 뒤에서 똑같은 코드가 추가로 실행될 때, 이 반복되는 부분을 피호출 함수로 합치는 방법을 생각해보자. 문장들을 함수로 옮기려면 그 문장들이 피호출 함수의 일부라는 확신이 있어야 한다.
- 만약 그 문장들이 피호출 함수와 한 몸은 아니지만 여전히 함께 호출돼야 하는 경우라면, 해당 문장들과 피호출 함수를 통째로 또 하나의 함수로 추출한다.
- 함수 추출하기(6.4)와의 차이는?
    - 문장을 함수로 옮기기는 중복 제거에, 함수 추출하기는 구현과 목적을 분리하는 것에 중점을 둔다.

### 8.4 문장을 호출한 곳으로 옮기기

↔ 문장을 함수로 옮기기

(책 내 리팩토링 과정을 참고하기)
간단하게 이 리팩토링이 이뤄질 수 있지만,  
까다로운 상황에서도 잘 대처할 수 있도록 복잡하지만 더 안전한 리팩토링 과정을 안내하고 있다.

### 8.5 인라인 코드를 함수 호출로 바꾸기

함수는 여러 동작을 하나로 묶어준다. 또한 **함수의 이름이 코드의 동작 방식보다는 목적**을 말해주기 때문에 함수를 활용하면 코드를 이해하기가 쉬워진다.

- 이미 존재하는 함수와 똑같은 일을 하는 인라인 코드를 발견하면 해당 코드를 함수 호출로 대체하자
    - 사용 중인 프로그래밍 언어의 표준 라이브러리나 플랫폼이 제공하는 API
    - 기존에 만들어 놓은 함수
- 함수 추출하기(6.1)와 이번 리팩터링의 차이는 대체 함수가 이미 존재하느냐 여부다.

### 8.6 문장 슬라이드하기

- 목적: 관련된 코드를 모아 이해를 쉽게하기 위해
- 관련된 코드를 모으면 이해하기가 쉬워진다. 하나의 데이터 구조를 이용하는 문장들을 모아보자.
- 보통 다른 리팩터링(주로 함수 추출하기)의 준비 단계로 자주 쓰인다.
- 이 리팩토링이 필요한 곳은 가장 흔한 사례는 변수를 선언하고 사용할 때다. 종종 모든 변수 선언을 함수 첫머리에 모아 두는 경우! 변수 선언을 모아두기 보다는 변수를 처음 사용할 때 선언하는 건 어떨까? (즉, 요소를 선언하는 곳과 사용하는 곳을 가까이 두자)
- 리팩터링 후 부수 효과에 주의해야 한다. How?
    - `명령-질의 분리 원칙`을 지키자.
        - 이 원칙을 잘 지키면 값을 반환하는 함수는 모두 부수효과가 없음을 보증(?)할 수 있다.
        - 명령-질의 분리 원칙이란? 함수는 크게 두 가지로 분류할 수 있는데 하나는 어떤 동작을 수행하는 명령이고 다른 하나는 답을 구하는 질의다.

### 8.7 반복문 쪼개기

- 반복문 하나에서 두 가지 이상의 일을 수행하는 경우 이를 쪼개서 의존성을 분리하자

    반복문 하나에서 두 가지 일을 수행하면 두 일을 한꺼번에 처리할 수 있다는 장점(?)이 있지만, 이 경우 반복문을 수정해야 할 때마다  두 가지 일 모두 잘 이해하고 진행해야 한다. 반면, 각각의 반복문으로 분리해두면 수정할 한 부분만 이해하면 된다.

- 반복문을 분리하면 수정이 쉬워지고, 분리한 후 함수로 추출하기 쉬워진다.
- 음.. 반복문을 쪼개면 느려지지 않나요? 
    → 리팩터링과 최적화는 다르다. 최적화는 코드를 깔끔히 정리한 이후에 수행하자. 
    리팩터링이 최적화하는 것은 아니지만, 더 강력한 최적화를 적용할 수 있는 길을 열어주기도 한다.

### 8.8 반복문을 파이프라인으로 바꾸기

논리를 파이프라인으로 표현하면 이해하기 훨씬 쉬워진다.

- [ ]  [Interlude: Rethinking the JavaScript Pipeline Operator](https://www.wix.engineering/post/interlude-rethinking-the-javascript-pipeline-operator)

### 8.9 죽은 코드 제거하기

사용되지 않는 코드가 있다면 그 소프트웨어의 동작을 이해하는 데 커다란 걸림돌이 될 수 있다. 운 나쁜 프로그래머는 이 코드의 동작을 이해하기 위해, 그리고 코드를 수정했는데도 기대한 결과가 나오지 않는 이유를 파악하기 위해 시간을 허비하게 된다.

- 코드가 더 이상 사용되지 않게 됐다면 지워야 한다.
- 혹 다시 필요해질 날이 오지 않을까 걱정할 필요 없다. 우리에겐 버전 관리 시스템이 있다.